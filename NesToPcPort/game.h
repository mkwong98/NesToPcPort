#pragma once
#include <SDL3/SDL.h>
#include <vector>

class console;
class mapper;

struct stackEntry {
	bool isPC;
	Uint16 value;
};

struct callStackEntry {
	bool isManual;
	Uint16 value;
};

class game
{
public:
	console* myConsole;
	mapper* myMapper;
	Uint8 a;
	Uint8 x;
	Uint8 y;
	Uint8 s;
	bool flgC;
	bool flgZ;
	bool flgI;
	bool flgD;
	bool flgV;
	bool flgN;
	bool flgB;
	stackEntry poppedEntry;
	callStackEntry poppedStackEntry;
	Uint32 threadSignal;
	Uint32 pushedAddress;
	bool gameEnded;

	game();
	void initGame();
	void endGame();
	Uint8 getStatus();
	void setStatus(Uint8 p);
	void opADC(Uint8 v);
	void opSBC(Uint8 v);
	void opAND(Uint8 v);
	void opORA(Uint8 v);
	void opEOR(Uint8 v);
	void opBIT(Uint8 v);

	void opINC(Uint16 address, Uint8 repeatTimes);
	void opDEC(Uint16 address, Uint8 repeatTimes);
	void opINX(Uint8 repeatTimes);
	void opDEX(Uint8 repeatTimes);
	void opINY(Uint8 repeatTimes);
	void opDEY(Uint8 repeatTimes);

	void opASL_A(Uint8 repeatTimes);
	void opASL_M(Uint16 address, Uint8 repeatTimes);
	void opLSR_A(Uint8 repeatTimes);
	void opLSR_M(Uint16 address, Uint8 repeatTimes);
	void opROL_A(Uint8 repeatTimes);
	void opROL_M(Uint16 address, Uint8 repeatTimes);
	void opROR_A(Uint8 repeatTimes);
	void opROR_M(Uint16 address, Uint8 repeatTimes);
	void opCMP(Uint8 v1, Uint8 v2);

	void setLoadFlag(Uint8 v);

	std::vector<callStackEntry> callStack;
	void pushAddress(Uint16 address);
	void pushManualAddress(Uint16 address);
	void popAddress();
	bool handleReturnAddress(Uint16 address, Uint16 expectedAddress);

	void pushStatus();
	void popStatus();
	void opPLA();
	void opPHA();

	void wait(Uint8 type);
	void signal();

	void repeat();
	void brk();

	bool needWaitScanline;
	Uint8 waitScanline;
	void atScanline(Uint8 scanline);

	void atSprite0Hit();

	void SUB_010000();
	void SUB_010003();
	void SUB_01000C();
	void SUB_01000F();
	void SUB_010012();
	void SUB_010031();
	void SUB_0100A6();
	void SUB_01011A();
	void SUB_010209();
	void SUB_01025D();
	void SUB_010279();
	void SUB_010304();
	void SUB_01030A();
	void SUB_01032B();
	void SUB_010365();
	void SUB_01036E();
	void SUB_01037D();
	void SUB_010396();
	void SUB_0103A5();
	void SUB_0103A6();
	void SUB_0103C2();
	void SUB_0103E9();
	void SUB_0103EA();
	void SUB_0103F5();
	void SUB_0103FE();
	void SUB_010425();
	void SUB_010437();
	void SUB_010448();
	void SUB_010486();
	void SUB_0104AA();
	void SUB_0104E5();
	void SUB_0104F6();
	void SUB_010501();
	void SUB_010507();
	void SUB_01055B();
	void SUB_0105BB();
	void SUB_0105CA();
	void SUB_0105E3();
	void SUB_0105F1();
	void SUB_010606();
	void SUB_015484();
	void SUB_0154D4();
	void SUB_0155A0();
	void SUB_0155C5();
	void SUB_015646();
	void SUB_0156CD();
	void SUB_015748();
	void SUB_01577D();
	void SUB_0157B7();
	void SUB_0157CA();
	void SUB_0157DD();
	void SUB_0157FA();
	void SUB_015815();
	void SUB_0158F7();
	void SUB_01597D();
	void SUB_0159A8();
	void SUB_0159C2();
	void SUB_015A6D();
	void SUB_015B26();
	void SUB_015B4D();
	void SUB_015C95();
	void SUB_015D0C();
	void SUB_015D96();
	void SUB_015E1C();
	void SUB_018000();
	void SUB_019CF1();
	void SUB_019D50();
	void SUB_019D59();
	void SUB_019D79();
	void SUB_019D98();
	void SUB_019DBA();
	void SUB_019E2D();
	void SUB_019EF3();
	void SUB_019F13();
	void SUB_01A073();
	void SUB_01AE8E();
	void SUB_01AEB1();
	void SUB_01AEDD();
	void SUB_01AEE3();
	void SUB_01AF22();
	void SUB_01B005();
	void SUB_01B031();
	void SUB_01B0E4();
	void SUB_01B119();
	void SUB_01B172();
	void SUB_01B1AC();
	void SUB_01B1C2();
	void SUB_01B1F6();
	void SUB_01B263();
	void SUB_01B2CD();
	void SUB_01B32C();
	void SUB_01B3C1();
	void SUB_01B408();
	void SUB_01B425();
	void SUB_01B53A();
	void SUB_01B5A3();
	void SUB_01B68B();
	void SUB_01B70F();
	void SUB_01B7F4();
	void SUB_01BAFC();
	void SUB_01BB88();
	void SUB_01BBDD();
	void SUB_01BC6F();
	void SUB_01BCA5();
	void SUB_01BCF5();
	void SUB_01BD2E();
	void SUB_01BD5C();
	void SUB_01BD9A();
	void SUB_01BE18();
	void SUB_01C000();
	void SUB_01C030();
	void SUB_01C052();
	void SUB_01C060();
	void SUB_01C075();
	void SUB_01C0B6();
	void SUB_01C9F6();
	void SUB_01CA04();
	void SUB_01CA15();
	void SUB_01CA17();
	void SUB_01CA70();
	void SUB_01D60E();
	void SUB_01DB37();
	void SUB_01DB6A();
	void SUB_01DB89();
	void SUB_01DBA4();
	void SUB_01DBB3();
	void SUB_01DBBA();
	void SUB_01DBE8();
	void SUB_01DCB2();
	void SUB_01DCD8();
	void SUB_01DCFD();
	void SUB_01DD0B();
	void SUB_01DD26();
	void SUB_01DD59();
	void SUB_01DF13();
	void SUB_01DF61();
	void SUB_01DFAC();
	void SUB_01DFCE();
	void SUB_01E0BC();
	void SUB_01E95B();
	void SUB_01E9E6();
	void SUB_01EA06();
	void SUB_01EA1B();
	void SUB_01EA36();
	void SUB_01EA3E();
	void SUB_01EA4F();
	void SUB_01EA98();
	void SUB_01EB66();
	void SUB_01EB90();
	void SUB_01EC81();
	void SUB_01ED03();
	void SUB_01EDE5();
	void SUB_01EE3E();
	void SUB_01EE99();
	void SUB_01EF3D();
	void SUB_01EFCD();
	void SUB_01F036();
	void SUB_01F0C6();
	void SUB_01F0CE();
	void SUB_01F0DA();
	void SUB_01F0E1();
	void SUB_01F0EE();
	void SUB_01F0F9();
	void SUB_01F149();
	void SUB_01F155();
	void SUB_01F162();
	void SUB_01F189();
	void SUB_01F218();
	void SUB_01F23A();
	void SUB_01F270();
	void SUB_01F2A0();
	void SUB_01F356();
	void SUB_01F847();
	void SUB_01F89D();
	void SUB_01FEB2();
	void SUB_01FF99();
	void SUB_01FFAA();
	void SUB_01FFBE();
	void SUB_01FFD2();
	void SUB_01FFE6();

	void nmi();
	void reset();
	void jump(Uint16 target);

};

