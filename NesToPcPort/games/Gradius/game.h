#pragma once
#include <SDL3/SDL.h>
#include <vector>

class console;
class mapper;

struct stackEntry {
	bool isPC;
	Uint16 value;
};

class game
{
public:
	console* myConsole;
	mapper* myMapper;
	Uint8 a;
	Uint8 x;
	Uint8 y;
	Uint8 s;
	bool flgC;
	bool flgZ;
	bool flgI;
	bool flgD;
	bool flgV;
	bool flgN;
	bool flgB;
	stackEntry poppedEntry;
	Uint32 threadSignal;
	Uint32 pushedAddress;
	bool gameEnded;

	game();
	void initGame();
	void endGame();
	Uint8 getStatus();
	void setStatus(Uint8 p);
	void opADC(Uint8 v);
	void opSBC(Uint8 v);
	void opAND(Uint8 v);
	void opORA(Uint8 v);
	void opEOR(Uint8 v);
	void opBIT(Uint8 v);

	void opINC(Uint16 address, Uint8 repeatTimes);
	void opDEC(Uint16 address, Uint8 repeatTimes);
	void opINX(Uint8 repeatTimes);
	void opDEX(Uint8 repeatTimes);
	void opINY(Uint8 repeatTimes);
	void opDEY(Uint8 repeatTimes);

	void opASL_A(Uint8 repeatTimes);
	void opASL_M(Uint16 address, Uint8 repeatTimes);
	void opLSR_A(Uint8 repeatTimes);
	void opLSR_M(Uint16 address, Uint8 repeatTimes);
	void opROL_A(Uint8 repeatTimes);
	void opROL_M(Uint16 address, Uint8 repeatTimes);
	void opROR_A(Uint8 repeatTimes);
	void opROR_M(Uint16 address, Uint8 repeatTimes);
	void opCMP(Uint8 v1, Uint8 v2);

	void setLoadFlag(Uint8 v);

	std::vector<Uint16> callStack;
	void pushAddress(Uint16 address);
	void popAddress();
	bool handleReturnAddress(Uint16 address, Uint16 expectedAddress);

	void pushStatus();
	void popStatus();
	void opPLA();
	void opPHA();

	void wait();
	void signal();

	void repeat();
	void brk();

	bool needWaitScanline;
	Uint8 waitScanline;
	void atScanline(Uint8 scanline);

	void atSprite0Hit();

	void reset();
	void nmi();
	void nmi_B();
	void SUB_0000BE();
	void SUB_0000E2();
	void SUB_000111();
	void SUB_000115();
	void SUB_000116();
	void SUB_000121();
	void SUB_000131();
	void SUB_000137();
	void SUB_000165();
	void SUB_00016C();
	void SUB_00017D();
	void SUB_00017F();
	void SUB_000186();
	void SUB_000188();
	void SUB_00018F();
	void SUB_00019B();
	void SUB_00019D();
	void SUB_0001AB();
	void SUB_0001B5();
	void SUB_0001BF();
	void SUB_000201();
	void SUB_00020B();
	void SUB_00020F();
	void SUB_000211();
	void SUB_000215();
	void SUB_00021A();
	void SUB_000256();
	void SUB_000279();
	void SUB_000281();
	void SUB_0002A1();
	void SUB_0002B6();
	void SUB_0002C7();
	void SUB_0002D5();
	void SUB_000307();
	void SUB_000333();
	void SUB_000336();
	void SUB_000357();
	void SUB_00039F();
	void SUB_0003AB();
	void SUB_0003B0();
	void SUB_0003B5();
	void SUB_0003E4();
	void SUB_000402();
	void SUB_00040C();
	void SUB_000418();
	void SUB_000424();
	void SUB_000430();
	void SUB_00043F();
	void SUB_00044B();
	void SUB_00044F();
	void SUB_000453();
	void SUB_000455();
	void SUB_00045B();
	void SUB_000463();
	void SUB_000469();
	void SUB_00046F();
	void SUB_0004A5();
	void SUB_0004A9();
	void SUB_0004D3();
	void SUB_000510();
	void SUB_00051C();
	void SUB_000523();
	void SUB_0005E8();
	void SUB_0005F3();
	void SUB_00063D();
	void SUB_000641();
	void SUB_000645();
	void SUB_000647();
	void SUB_00064B();
	void SUB_000824();
	void SUB_00082C();
	void SUB_00082E();
	void SUB_000871();
	void SUB_000898();
	void SUB_0008B6();
	void SUB_0008F6();
	void SUB_000906();
	void SUB_000915();
	void SUB_00092C();
	void SUB_00094B();
	void SUB_000974();
	void SUB_000983();
	void SUB_000984();
	void SUB_0009A1();
	void SUB_0009AF();
	void SUB_0009BB();
	void SUB_0009BD();
	void SUB_0009C9();
	void SUB_0009CF();
	void SUB_0009D3();
	void SUB_0009DD();
	void SUB_0009E3();
	void SUB_000A30();
	void SUB_000A51();
	void SUB_000A9C();
	void SUB_000A9E();
	void SUB_000AAC();
	void SUB_000B10();
	void SUB_000B93();
	void SUB_000BAB();
	void SUB_000BAF();
	void SUB_000BC2();
	void SUB_000BC3();
	void SUB_000BD9();
	void SUB_000C06();
	void SUB_00164D();
	void SUB_001650();
	void SUB_001765();
	void SUB_00179D();
	void SUB_0017C5();
	void SUB_0017DD();
	void SUB_0017F1();
	void SUB_00182A();
	void SUB_00184F();
	void SUB_001872();
	void SUB_00188C();
	void SUB_0018DD();
	void SUB_0018E5();
	void SUB_0018EE();
	void SUB_001904();
	void SUB_00194A();
	void SUB_00197E();
	void SUB_001982();
	void SUB_0019B7();
	void SUB_0019BA();
	void SUB_0019C0();
	void SUB_0019DF();
	void SUB_0019E9();
	void SUB_001A0E();
	void SUB_001A4D();
	void SUB_001A5B();
	void SUB_001A5E();
	void SUB_001A8C();
	void SUB_001AC4();
	void SUB_001B3E();
	void SUB_001BED();
	void SUB_001BF0();
	void SUB_001C09();
	void SUB_001C12();
	void SUB_001C1E();
	void SUB_001C24();
	void SUB_001C3C();
	void SUB_001C45();
	void SUB_001C5E();
	void SUB_001C6D();
	void SUB_001C88();
	void SUB_001C96();
	void SUB_001CB0();
	void SUB_001CB1();
	void SUB_001D83();
	void SUB_001D8E();
	void SUB_001FFC();
	void SUB_002235();
	void SUB_002250();
	void SUB_002266();
	void SUB_00226B();
	void SUB_002285();
	void SUB_002297();
	void SUB_0022A9();
	void SUB_0022C0();
	void SUB_002397();
	void SUB_0023B1();
	void SUB_0023E4();
	void SUB_002411();
	void SUB_002466();
	void SUB_0024A6();
	void SUB_002527();
	void SUB_002579();
	void SUB_002DAB();
	void SUB_002DE5();
	void SUB_002E70();
	void SUB_002E99();
	void SUB_002EDD();
	void SUB_002EE1();
	void SUB_002EF8();
	void SUB_002F09();
	void SUB_002F10();
	void SUB_002F2B();
	void SUB_002F2E();
	void SUB_002F33();
	void SUB_002F43();
	void SUB_002F54();
	void SUB_002F88();
	void SUB_002F98();
	void SUB_003026();
	void SUB_003033();
	void SUB_003038();
	void SUB_003098();
	void SUB_0030AF();
	void SUB_0030B4();
	void SUB_0030BE();
	void SUB_003103();
	void SUB_003109();
	void SUB_003111();
	void SUB_003116();
	void SUB_003117();
	void SUB_003120();
	void SUB_003130();
	void SUB_003140();
	void SUB_003154();
	void SUB_003164();
	void SUB_003165();
	void SUB_00316C();
	void SUB_00317C();
	void SUB_00317D();
	void SUB_003184();
	void SUB_003198();
	void SUB_0031AA();
	void SUB_0031B1();
	void SUB_0031C2();
	void SUB_0031DA();
	void SUB_0031DF();
	void SUB_0031E5();
	void SUB_0031E8();
	void SUB_0031EB();
	void SUB_0031F1();
	void SUB_0031F4();
	void SUB_0031FA();
	void SUB_003205();
	void SUB_00320A();
	void SUB_003212();
	void SUB_00321A();
	void SUB_00322E();
	void SUB_003233();
	void SUB_003250();
	void SUB_003251();
	void SUB_00326C();
	void SUB_0032AF();
	void SUB_0032B5();
	void SUB_0032BB();
	void SUB_0032C0();
	void SUB_0032D2();
	void SUB_0032DB();
	void SUB_0032E6();
	void SUB_0032EE();
	void SUB_003304();
	void SUB_003311();
	void SUB_00331E();
	void SUB_003343();
	void SUB_003367();
	void SUB_00336F();
	void SUB_003377();
	void SUB_00337F();
	void SUB_0033A2();
	void SUB_0033A7();
	void SUB_0033AA();
	void SUB_0033CB();
	void SUB_0033F9();
	void SUB_0033FF();
	void SUB_003402();
	void SUB_003407();
	void SUB_00340F();
	void SUB_003412();
	void SUB_003434();
	void SUB_003480();
	void SUB_0034F2();
	void SUB_0034FD();
	void SUB_003502();
	void SUB_003510();
	void SUB_003559();
	void SUB_003569();
	void SUB_00361E();
	void SUB_003628();
	void SUB_003647();
	void SUB_00364F();
	void SUB_00365C();
	void SUB_003676();
	void SUB_003690();
	void SUB_003693();
	void SUB_003697();
	void SUB_00369E();
	void SUB_0036A2();
	void SUB_0036B8();
	void SUB_0036E1();
	void SUB_003707();
	void SUB_00370B();
	void SUB_003710();
	void SUB_00371B();
	void SUB_00371D();
	void SUB_003720();
	void SUB_003723();
	void SUB_003747();
	void SUB_0037A1();
	void SUB_003913();
	void SUB_003914();
	void SUB_003983();
	void SUB_0039A8();
	void SUB_0039B7();
	void SUB_0039F2();
	void SUB_003A0A();
	void SUB_003B0F();
	void SUB_003BB7();
	void SUB_003C44();
	void SUB_003CB1();
	void SUB_003CB5();
	void SUB_003D2C();
	void SUB_003D7E();
	void SUB_003DD5();
	void SUB_003DFA();
	void SUB_003E93();
	void SUB_003EF3();
	void SUB_003F0B();
	void SUB_003F75();
	void SUB_003FE2();
	void SUB_004055();
	void SUB_0040AE();
	void SUB_0040B7();
	void SUB_0040BD();
	void SUB_0040C6();
	void SUB_0040C7();
	void SUB_0041D6();
	void SUB_0041FD();
	void SUB_00420A();
	void SUB_0042A5();
	void SUB_0042C4();
	void SUB_0042FF();
	void SUB_00432F();
	void SUB_0043A3();
	void SUB_0043AF();
	void SUB_0043D3();
	void SUB_00440E();
	void SUB_004413();
	void SUB_004429();
	void SUB_00442A();
	void SUB_00444F();
	void SUB_004486();
	void SUB_0044E4();
	void SUB_004526();
	void SUB_004546();
	void SUB_00458D();
	void SUB_0045AD();
	void SUB_004633();
	void SUB_004653();
	void SUB_004686();
	void SUB_0046DE();
	void SUB_004752();
	void SUB_004772();
	void SUB_00477C();
	void SUB_004822();
	void SUB_004906();
	void SUB_004A5E();
	void SUB_004B26();
	void SUB_004B28();
	void SUB_004B2B();
	void SUB_004B4E();
	void SUB_004B8A();
	void SUB_004B91();
	void SUB_004BD1();
	void SUB_004C19();
	void SUB_004C33();
	void SUB_004DA5();
	void SUB_004DB3();
	void SUB_004E89();
	void SUB_004E94();
	void SUB_004F23();
	void SUB_004F25();
	void SUB_004F28();
	void SUB_006C1E();
	void SUB_006CB6();
	void SUB_006CC7();
	void SUB_006CD2();
	void SUB_006CE5();
	void SUB_006CEB();
	void SUB_006D02();
	void SUB_006D46();
	void SUB_006F62();
	void SUB_006FA6();
	void indirectJump(Uint16 target);

};

